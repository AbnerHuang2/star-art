<template>
	<div class="header-container">
		<div class="header">
			<el-menu :default-active="$route.path" router mode="horizontal" text-color="#24243e" active-text-color="#000000">
				<el-menu-item v-for="(item,index) in navList" :key="index" :index="item.name">
					<i v-if="index==1" class="el-icon-postcard"></i>
					<i v-if="index==2" class="el-icon-user"></i>
					<i v-if="index==3" class="el-icon-copy-document"></i>
					<i v-if="index==4" class="el-icon-message"></i>
					<span>{{item.navItem}}</span>
				</el-menu-item>
			</el-menu>
			<div class="logo">
				<img src="../../public/star.png" alt="LOGO">
			</div>
			<!-- 头像 -->
			<div class="loginBtn">
				<!-- 未登录状态 -->
				<el-button class="loginBt" v-if="!user" icon="el-icon-user-solid" @click="showModal=true">登录/注册</el-button>
				<!-- 登录状态 -->
				<div style="display: flex;" v-else>
					<el-tooltip class="item" effect="dark" content="站内信" placement="bottom">
						<div @click="clickMsg">
							<svg t="1590649020624" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3638" width="32" height="32"><path d="M288.3 181.4c0-17.2 14-31.2 31.2-31.2s31.2 14 31.2 31.2-14 31.2-31.2 31.2c-17.2 0.1-31.2-13.9-31.2-31.2z m15.4 0c0 8.8 7.1 15.9 15.9 15.9s15.9-7.1 15.9-15.9c0-8.7-7.1-15.9-15.9-15.9-8.8 0.1-15.9 7.2-15.9 15.9z" fill="#47B7F8" p-id="3639"></path><path d="M825.6 262.4h13.7v-13.7c0-3.7 3-6.6 6.6-6.6 3.7 0 6.6 3 6.6 6.6v13.7h13.7c3.7 0 6.6 3 6.6 6.6 0 3.7-3 6.6-6.6 6.6h-13.7v13.7c0 3.7-3 6.6-6.6 6.6-3.6 0-6.6-3-6.6-6.6v-13.7h-13.7c-3.6 0-6.6-3-6.6-6.6 0-3.6 3-6.6 6.6-6.6zM71.1 387h13.7v-13.7c0-3.7 3-6.6 6.6-6.6 3.7 0 6.6 3 6.6 6.6V387h13.7c3.7 0 6.6 3 6.6 6.6 0 3.7-3 6.6-6.6 6.6H98v13.7c0 3.7-3 6.6-6.6 6.6-3.6 0-6.6-3-6.6-6.6v-13.7H71.1c-3.6 0-6.6-3-6.6-6.6 0-3.6 3-6.6 6.6-6.6z" fill="#F7E42F" p-id="3640"></path><path d="M904.7 590.2h15.9v-15.9c0-4.2 3.4-7.7 7.7-7.7 4.2 0 7.7 3.4 7.7 7.7v15.9h15.9c4.2 0 7.7 3.4 7.7 7.7s-3.4 7.7-7.7 7.7H936v15.9c0 4.2-3.4 7.7-7.7 7.7-4.2 0-7.7-3.4-7.7-7.7v-15.9h-15.9c-4.2 0-7.7-3.4-7.7-7.7s3.5-7.7 7.7-7.7z" fill="#F8B62D" p-id="3641"></path><path d="M721.7 193m-11.5 0a11.5 11.5 0 1 0 23 0 11.5 11.5 0 1 0-23 0Z" fill="#F8B62D" p-id="3642"></path><path d="M206.8 253.7m-15.4 0a15.4 15.4 0 1 0 30.8 0 15.4 15.4 0 1 0-30.8 0Z" fill="#F8B62D" p-id="3643"></path><path d="M812.9 362.9m-15.4 0a15.4 15.4 0 1 0 30.8 0 15.4 15.4 0 1 0-30.8 0Z" fill="#F7E42F" p-id="3644"></path><path d="M782.2 503.4c0-17.2 14-31.2 31.2-31.2s31.2 14 31.2 31.2-14 31.2-31.2 31.2-31.2-14-31.2-31.2z m15.4 0c0 8.8 7.1 15.9 15.9 15.9s15.9-7.1 15.9-15.9c0-8.7-7.1-15.9-15.9-15.9s-15.9 7.1-15.9 15.9z" fill="#F8B62D" p-id="3645"></path><path d="M204.6 505.3c1.7-1.7 4.4-1.7 6 0 0.8 0.8 1.2 1.9 1.2 3s-0.4 2.2-1.2 3L197 524.9c-0.8 0.8-1.9 1.2-3 1.2s-2.2-0.4-3-1.2c-1.7-1.7-1.7-4.4 0-6l13.6-13.6zM168.5 541.3c0.8-0.8 1.9-1.2 3-1.2s2.2 0.4 3 1.2c1.7 1.7 1.7 4.4 0 6l-13.6 13.6c-0.8 0.8-1.9 1.2-3 1.2s-2.2-0.4-3-1.2c-0.8-0.8-1.2-1.9-1.2-3s0.4-2.2 1.2-3l13.6-13.6zM171.6 526.2c-1.1 0-2.2-0.4-3-1.2L155 511.4c-0.8-0.8-1.2-1.9-1.2-3s0.4-2.2 1.2-3c1.7-1.7 4.4-1.7 6 0l13.6 13.6c1.7 1.7 1.7 4.4 0 6-0.8 0.7-1.9 1.2-3 1.2zM196.9 541.3l13.6 13.6c0.8 0.8 1.2 1.9 1.2 3s-0.4 2.2-1.2 3c-0.8 0.8-1.9 1.2-3 1.2s-2.2-0.4-3-1.2l-13.6-13.6c-1.7-1.7-1.7-4.4 0-6 1.6-1.6 4.4-1.6 6 0zM194.3 533.1c0-2.3 1.9-4.3 4.2-4.3h19.3c2.3 0 4.2 1.9 4.2 4.3s-1.9 4.2-4.2 4.2h-19.3c-2.3 0-4.2-1.9-4.2-4.2zM147.6 528.8h19.3c2.3 0 4.3 1.9 4.3 4.3s-1.9 4.2-4.3 4.2h-19.3c-2.3 0-4.3-1.9-4.3-4.2s2-4.3 4.3-4.3zM182.7 493.7c2.3 0 4.3 1.9 4.3 4.2v19.3c0 2.3-1.9 4.2-4.3 4.2s-4.2-1.9-4.2-4.2V498c0-2.4 1.9-4.3 4.2-4.3zM182.7 544.7c2.3 0 4.3 1.9 4.3 4.3v19.3c0 2.3-1.9 4.3-4.3 4.3s-4.2-1.9-4.2-4.3V549c0-2.4 1.9-4.3 4.2-4.3z" fill="#FAEE00" p-id="3646"></path><path d="M554.7 89.5c1.7-1.7 4.4-1.7 6 0 0.8 0.8 1.2 1.9 1.2 3s-0.4 2.2-1.2 3l-13.6 13.6c-0.8 0.8-1.9 1.2-3 1.2s-2.2-0.4-3-1.2c-1.7-1.7-1.7-4.4 0-6l13.6-13.6zM518.7 125.5c0.8-0.8 1.9-1.2 3-1.2s2.2 0.4 3 1.2c1.7 1.7 1.7 4.4 0 6l-13.6 13.6c-0.8 0.8-1.9 1.2-3 1.2s-2.2-0.4-3-1.2c-0.8-0.8-1.2-1.9-1.2-3s0.4-2.2 1.2-3l13.6-13.6zM521.7 110.4c-1.1 0-2.2-0.4-3-1.2l-13.6-13.6c-0.8-0.8-1.2-1.9-1.2-3s0.4-2.2 1.2-3c1.7-1.7 4.4-1.7 6 0l13.6 13.6c1.7 1.7 1.7 4.4 0 6-0.8 0.8-1.9 1.2-3 1.2zM547.1 125.5l13.6 13.6c0.8 0.8 1.2 1.9 1.2 3s-0.4 2.2-1.2 3c-0.8 0.8-1.9 1.2-3 1.2s-2.2-0.4-3-1.2l-13.6-13.6c-1.7-1.7-1.7-4.4 0-6 1.6-1.6 4.4-1.6 6 0zM544.5 117.4c0-2.3 1.9-4.3 4.2-4.3H568c2.3 0 4.2 1.9 4.2 4.3s-1.9 4.2-4.2 4.2h-19.3c-2.3 0-4.2-1.9-4.2-4.2zM497.8 113.1h19.3c2.3 0 4.3 1.9 4.3 4.3s-1.9 4.2-4.3 4.2h-19.3c-2.3 0-4.3-1.9-4.3-4.2s1.9-4.3 4.3-4.3zM532.9 78c2.3 0 4.3 1.9 4.3 4.2v19.3c0 2.3-1.9 4.2-4.3 4.2s-4.2-1.9-4.2-4.2V82.3c-0.1-2.4 1.8-4.3 4.2-4.3zM532.9 128.9c2.3 0 4.3 1.9 4.3 4.3v19.3c0 2.3-1.9 4.3-4.3 4.3s-4.2-1.9-4.2-4.3v-19.3c-0.1-2.4 1.8-4.3 4.2-4.3z" fill="#F8B62D" p-id="3647"></path><path d="M777.6 849.3H272.9c-15.2 0-27.6-12.6-27.6-28.1l69-119.9V509.8c0-118 94.9-214.5 210.9-214.5s210.9 96.5 210.9 214.5v191.5l69 119.9c0.1 15.5-12.3 28.1-27.5 28.1z" fill="#FCEE21" p-id="3648"></path><path d="M446.8 272.4c0-33.6 27.3-60.9 60.9-60.9s60.9 27.3 60.9 60.9" fill="#F8B62D" p-id="3649"></path><path d="M568.6 283.9c-6.4 0-11.5-5.2-11.5-11.5 0-27.2-22.2-49.4-49.4-49.4s-49.4 22.2-49.4 49.4c0 6.4-5.2 11.5-11.5 11.5s-11.5-5.2-11.5-11.5c0-39.9 32.5-72.4 72.4-72.4 40 0 72.4 32.5 72.4 72.4 0 6.4-5.1 11.5-11.5 11.5z" fill="#3E3A39" p-id="3650"></path><path d="M593.8 848.3c0 47.6-38.6 86.2-86.2 86.2s-86.2-38.6-86.2-86.2" fill="#F8B62D" p-id="3651"></path><path d="M507.7 946c-53.9 0-97.7-43.8-97.7-97.7 0-6.4 5.2-11.5 11.5-11.5S433 842 433 848.3c0 41.2 33.5 74.6 74.6 74.6 41.2 0 74.6-33.5 74.6-74.6 0-6.4 5.2-11.5 11.5-11.5s11.5 5.2 11.5 11.5c0.2 53.9-43.7 97.7-97.5 97.7z" fill="#3E3A39" p-id="3652"></path><path d="M891.7 946h-27.4c-6.4 0-11.5-5.2-11.5-11.5S858 923 864.3 923h27.4c6.4 0 11.5 5.2 11.5 11.5s-5.1 11.5-11.5 11.5zM158.7 946h-35.1c-6.4 0-11.5-5.2-11.5-11.5s5.2-11.5 11.5-11.5h35.1c6.4 0 11.5 5.2 11.5 11.5s-5.1 11.5-11.5 11.5zM830.4 946H197.5c-6.4 0-11.5-5.2-11.5-11.5s5.2-11.5 11.5-11.5h632.9c6.4 0 11.5 5.2 11.5 11.5s-5.1 11.5-11.5 11.5z" fill="#3E3A39" p-id="3653"></path><path d="M742.7 502c0-85.6-58.9-158.3-144.2-191.9 61.1 67.6 77.7 169.5 75.5 238.7L669.5 694c-0.2 7.9 2.5 15.7 7.8 21.6l43.2 49.2c16.4 18.7 5.5 48.2-19.2 51.6l-180.6 25.1h264.2c15.4 0 28.1-12.6 28.1-28.1l-70.2-119.9V502z" fill="#F8B62D" p-id="3654"></path><path d="M320.1 380.4c-1.5 0-3.1-0.3-4.6-0.9-5.8-2.5-8.5-9.3-6-15.2 5-11.5 12.7-21.8 22.5-29.7 4.9-4 12.2-3.3 16.2 1.6s3.3 12.2-1.6 16.2c-6.9 5.6-12.4 12.9-15.9 21-1.9 4.4-6.1 7-10.6 7z" fill="#3E3A39" p-id="3655"></path><path d="M775.9 860.8H239.5c-22.5 0-40.9-18.3-40.9-40.9 0-2 0.5-4.1 1.6-5.8L272 691.5V494.4c0-32.3 6.5-63.6 19.2-93.1 2.5-5.8 9.3-8.5 15.2-6 5.8 2.5 8.5 9.3 6 15.1-11.5 26.6-17.4 54.8-17.4 83.9v200.2c0 2-0.5 4.1-1.6 5.8l-71.5 122.2c1.3 8.5 8.7 15.1 17.6 15.1h536.4c8.9 0 16.3-6.5 17.6-15.1L722 700.3c-1-1.8-1.6-3.8-1.6-5.8V494.4c0-117.3-95.4-212.7-212.7-212.7-48.6 0-96.3 17-134.1 47.9-4.9 4-12.2 3.3-16.2-1.6s-3.3-12.2 1.6-16.2c42-34.3 94.8-53.1 148.7-53.1 130 0 235.7 105.7 235.7 235.7v197.1l71.8 122.6c1 1.8 1.6 3.8 1.6 5.8-0.1 22.6-18.4 40.9-40.9 40.9z" fill="#3E3A39" p-id="3656"></path><path d="M354.7 654.7c-6.4 0-11.5-5.2-11.5-11.5V502.4c0-6.4 5.2-11.5 11.5-11.5s11.5 5.2 11.5 11.5v140.8c0 6.3-5.1 11.5-11.5 11.5z" fill="#FFFFFF" p-id="3657"></path><path d="M357 474.7c-0.8 0-1.5-0.1-2.3-0.2-6.2-1.3-10.3-7.3-9-13.6 4.3-21.7 9.6-35.2 15.6-39.9 5-4 12.2-3.2 16.2 1.8 3.8 4.7 3.2 11.5-1.1 15.6-2.1 3.2-5.8 15.6-8.1 27.1-1.1 5.4-5.9 9.2-11.3 9.2z m18.7-35.8z" fill="#FFFFFF" p-id="3658"></path></svg>
						</div>
					</el-tooltip>
					<div class="demo-type">
						<div @click="showPersonInfo">
							<el-avatar :size="40" :src="user.userAvatarURL"></el-avatar>
						</div>
						<ul class="avatar-options">
							<li @click="showPersonInfo">个人中心</li>
							<li>
								<el-popconfirm title="确定退出登录吗" confirmButtonText="是 的" 
								cancelButtonText="再想想" @onConfirm="logout">
									<span type="text" slot="reference">退出登录</span>
								</el-popconfirm>
							</li>
						</ul>
					</div>
				</div>
				
				<el-input style="margin-right: 1.875rem;" placeholder="搜我试试" prefix-icon="el-icon-search" v-model="globalInput">
				</el-input>
			</div>
		</div>
		<!-- 登录弹窗 -->
		<logindialog :showModal="showModal" @on-close="closeDialog"></logindialog>
		<!-- /登录弹窗 -->
	</div>

</template>

<script>
	import logindialog from "../views/login-dialog.vue"
	//引入ajax
	import axios from "axios";
	//支持携带cookie
	axios.defaults.withCredentials = true;
	export default {
		components:{
			logindialog
		},
		data() {
			return {
				showModal:false,
				user: '',
				activeIndex: '1',
				globalInput:'',
				navList: [{
						name: '/',
						navItem: '首页'
					},
					{
						name: '/course',
						navItem: '课程'
					},
					{
						name: '/teacher',
						navItem: '导师'
					},
					{
						name: '/product',
						navItem: '作品'
					},
					{
						name: '/community',
						navItem: 'STAR 社区'
					}
				]
			};
		},
		methods: {
			handleSelect(key, keyPath) {
				console.log(key, keyPath);
			},
			// 关闭弹窗
			closeDialog(user){
				this.showModal = false;
				this.user = user;
				this.global.user = user;
				if(user!=null){
					//重新刷新页面
					this.$router.go(0)
				}
			},
			clickMsg(){
				this.$router.push({
					path: '/message' ,
					// query:{
					// 	id:this.user.id,
					// }
				})
			},
			async showPersonInfo(){
				// this.$router.push('/person')
				await this.$router.push({
					path: '/person' ,
					query:{
						id:this.user.id,
					}
				})
			},
			logout(){
				axios({
					url: this.global.serverSrc + "/member/logout",
					method: "get",
					
				}).then(res => {
					if(res.data.code==200){
						this.$notify.success({
							title: "已退出",
						});
						this.user = null;
						this.global.user = null;
						//如果在person页面，退出到首页
						if(this.$route.path == '/person'){
							this.$router.push('/')
						}
						//重新刷新页面
						this.$router.go(0)
					}
				})
			},
			async getUserInfo(){
				await axios({
					url: this.global.serverSrc + "/",
					method: "get",
					
				}).then(res => {
					if(res.data.code==200){
						this.user = res.data.data;
						this.global.user = res.data.data;
					}

				})
			},
			
		},
		created() {
			this.getUserInfo();
		},
	}
</script>

<style lang="scss" scoped>
	@import url('https://fonts.googleapis.com/css?family=Roboto:400,700');
	.header-container {
		width: 100%;
		display: flex;
		justify-content: center;
		position: fixed;
		z-index: 9;
		//box-shadow: 0px 1px 3px 1px #CCCCCC;;
	}

	.header {
		width: 75rem;
		height: 4.5rem;
		//border-bottom: 1px solid #CCCCCC;
		background-color: #FFFFFF;
		margin: 0 auto;
		display: flex;
		justify-content: left;
		//position: fixed;
		//z-index: 9;
	}

	.logo {
		width: 18rem;
		height: 4.5rem;
		margin-left: 8%;
	}

	.logo img {
		width: 3.5rem;
		height: auto;
		margin-top: 0.625rem;
		//border: 1px solid red;
		//transform: rotate(15deg);
	}

	.el-menu {
		font-weight: bolder;
		padding: 0.75rem;
	}

	.loginBtn {
		display: flex;
		flex: 1;
		flex-direction: row-reverse;
		align-items: center;
		//justify-content: center;
		padding-right: 1.25rem;
	}

	.loginBtn .loginBt {
		border-radius: 1.25rem;
		box-shadow: 0 2px 5px rgba(0, 0, 0, .2);
		font-weight: bold;
		color: #333333;
		background: #355C7D;
		/* fallback for old browsers */
		background: -webkit-linear-gradient(to right, #C06C84, #6C5B7B, #355C7D);
		/* Chrome 10-25, Safari 5.1-6 */
		background: linear-gradient(to right, #C06C84, #6C5B7B, #355C7D);
		/* W3C, IE 10+/ Edge, Firefox 16+, Chrome 26+, Opera 12+, Safari 7+ */
	}

	.loginBtn .loginBt:hover {
		color: snow;
	}
	
	.demo-type{
		position: relative;
	}
	.avatar-options{
		width: 5.4rem;
		margin: 0;
		padding: 2px;
		position: absolute;
		left: -30px;
		opacity: 0;
		background-color: #FFFFFF;
		border-radius: 5px;
		
		li{
			list-style-type: none;
			color: #2c3e50;
			text-align: center;
			font-family: 'Roboto', sans-serif;
			font-size: 0.85rem;
			font-weight: 700;
			letter-spacing: 0.2rem;
			padding: 5px 2px;
			
			&:hover{
				color: #c0392b;
				background-color: #ecf0f1;
			}
		}
	}
	.demo-type:hover .avatar-options{
		opacity: 1;
	}
	
</style>
